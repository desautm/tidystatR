# Les techniques d'échantillonnage {#techniquesechantillonnage}

Lorsqu’on souhaite effectuer un sondage plutôt qu’un recensement, il existe diverses façons pour déterminer quelles seront les n unités statistiques qui feront partie de l’échantillon. Celles-ci sont appelées techniques d’échantillonnage.

## Techniques d’échantillonnage aléatoires

Ces techniques permettent de choisir $n$ unités statistiques au hasard parmi la population. 

En choisissant une de ces techniques, il est possible de tirer des conclusions sur une population à partir des résultats d’un sondage puisque la marge d’erreur peut être calculée. 

Ces techniques nécessitent par contre une base de sondage, c’est-à-dire une liste de toutes les unités statistiques. 

Il existe 4 techniques d’échantillonnage aléatoires. 

- Simple: Les individus sont choisis aléatoirement parmi toutes les unités statistiques.
- Stratifié: La population est divisée en sous-ensembles ayant des caractéristiques communes (strates), puis des unités statistiques sont choisies parmi chacune des strates de façon aléatoire en respectant les proportions de la population. 
- Par grappes: La population est divisée en sous-ensembles préalablement existants (grappes). Des grappes sont sélectionnées aléatoirement et toutes les unités statistiques de ces grappes sont choisies. 
- Systématique: Les unités statistiques sont choisies à intervalles réguliers. Le pas de sondage, l’intervalle auquel sont choisies les unités statistiques, est $p=\frac{N}{n}$. La première unité statistique est choisie aléatoirement parmi les p premières unités statistiques.

## Techniques d’échantillonnage non-aléatoires

Ces techniques d’échantillonnage ne relèvent pas du hasard, mais elles sont souvent utilisées puisqu’elles ne nécessitent pas de base de sondage et sont par le fait même généralement plus faciles à mettre en application. 

- Accidentel/À l’aveuglette: Les unités statistiques sont choisies parce qu’elles sont présentes lorsque le sondage est effectué. 
- Volontaire: Les unités statistiques décident elles-mêmes de participer au sondage.
- Par quotas: La population est divisée en sous-ensembles ayant des caractéristiques communes, puis des unités statistiques sont choisies parmi chacun des sous-ensembles de façon accidentelle en respectant les proportions de la population.
- Au jugé: Le chercheur choisit des unités statistiques précises parce qu’il croit qu’elles sont représentatives de la population.

##  Base de données pour les _M&M's_

Voici les librairies utilisées.

```{r message = FALSE}
library(googlesheets)
library(tidyverse)
library(questionr)
library(knitr)
```

```{r echo=FALSE}
# Fonction pour transformer un tableau croisé en tidy data
elongate <- function(data){

  r <- nrow(data)
  c <- ncol(data)

  obs <- sum(data[(1:r), (2:c)])

  out <- tibble(Nom = character(), Couleur = character())

  for (i in (1:r)){
    for (j in (2:c)){
      temp <- tibble(Nom = rep(data[[i,1]],data[i,j]), 
                     Couleur =rep(colnames(data)[j],data[i,j]))
      out <- rbind(out, temp)
    }
  }

  return(out)

}
```

### Mise en place

Pour débuter, il faut remplir la feuille _Google Sheets_ qui contiendra les données. Elle se trouve à l'adresse suivante [MetM](https://docs.google.com/spreadsheets/d/16-kbE75LlCnj2GL9h6Ku9r6GnXbUfRGGxkq_vjiSoyc/edit?usp=sharing).

### Chargement de la feuille Google

Pour charger la feuille Google, nous utiliserons l'extension `googlesheets`.

```{r message=FALSE}
goo <- gs_url("https://docs.google.com/spreadsheets/d/16-kbE75LlCnj2GL9h6Ku9r6GnXbUfRGGxkq_vjiSoyc/edit?usp=sharing")
MetM <- gs_read(goo)
```

Nous pouvons visualiser les données:

```{r}
MetM
```

Pour être en mesure de travailler avec ses données, nous allons les transformer en _tidy data_ avec la fonction `elongate` chargée dans cette feuille.

```{r cleanup, echo=FALSE}
MetMtidy <- elongate(MetM)
MetMtidy$Couleur <- factor(MetMtidy$Couleur, levels = c("Bleu", "Brun", "Jaune", "Orange", "Rouge", "Vert"))
MetMtidy <- MetMtidy[sample(1:nrow(MetMtidy)),] # On mélange les données
MetMtidy
```

### Les _M&M's_

Voici les proportions des couleurs dans les paquets de _M&M's_ en date de 2008.

|Bleu|Orange|Vert|Jaune|Brun|Rouge|
|:--:|:--:|:--:|:--:|:--:|:--:|
|24%|20%|16%|14%|13%|13%|

Débutons par résumer toute l'information obtenue.

Voici la distribution des _M&M's_ par couleur.

```{r}
kable(freq(MetMtidy$Couleur,
           total = TRUE,
           valid = FALSE))
```

```{r}
ggplot(MetMtidy, aes(x = Couleur, fill = Couleur))+
  geom_bar(aes(y = (..count..)/sum(..count..)))+
  scale_fill_manual(guide=FALSE,
                    values = c("Bleu"="blue", 
                               "Brun"="brown",
                               "Jaune"="yellow",
                               "Orange"="orange",
                               "Rouge"="red",
                               "Vert"="green"))+
  labs(y = "Pourcentage")
```

Voici la distribution du nombre de _M&M's_ par paquet.

```{r}
kable(freq(MetMtidy$Nom,
           total = TRUE,
           valid = FALSE))
```

```{r}
ggplot(MetMtidy, aes(x = Nom))+
  geom_bar()+
  labs(y = "Nombre de M&M's")
```

Nous pouvons calculer le nombre moyen de _M&M's_ par paquet.

```{r}
MetMtidy %>%
  count(Nom) %>%
  summarise(avg = mean(n))
```

Voici la distribution du nombre de _M&M's_ de chaque couleur séparée par paquet.

```{r}
ggplot(MetMtidy, aes(x = Couleur, fill = Couleur))+
  geom_bar(aes(y = (..count..)/sum(..count..)))+
  scale_fill_manual(guide=FALSE,
                    values = c("Bleu"="blue", 
                               "Brun"="brown",
                               "Jaune"="yellow",
                               "Orange"="orange",
                               "Rouge"="red",
                               "Vert"="green"))+
  facet_wrap(~Nom)+
  labs(y = "Pourcentage")
```


### Simple



### Stratifié



### Par grappes

Pour utiliser des grappes, nous pouvons choisir certains paquets et observer tous les _M&M's_ dans ces paquets.

Création de la grappe.

```{r}
choix <- c("Anna", "Laurent", "Gabriel")
grappe <- MetMtidy %>%
  filter(Nom %in% choix)
```

Voici la distribution de _M&M's_ par couleur.

```{r}
kable(freq(grappe$Couleur,
     total = TRUE,
     valid = FALSE))
```

```{r}
ggplot(grappe, aes(x = Couleur, fill = Couleur))+
  geom_bar(aes(y = (..count..)/sum(..count..)))+
  scale_fill_manual(guide=FALSE,
                    values = c("Bleu"="blue", 
                               "Brun"="brown",
                               "Jaune"="yellow",
                               "Orange"="orange",
                               "Rouge"="red",
                               "Vert"="green"))+
  labs(y = "Pourcentage")
```

Voici la distribution du nombre de _M&M's_ par paquet.

```{r}
kable(freq(grappe$Nom,
           total = TRUE,
           valid = FALSE))
```

```{r}
ggplot(grappe, aes(x = Nom))+
  geom_bar()+
  labs(y = "Nombre de M&M's")
```

### Systématique

Pour cette méthode, nous choisissons une unité statistique au hasard, une taille d'échantillon et un pas de sondage.

```{r}
n <- 15 # La taille de l'échantillon

N <- nrow(MetMtidy) # La taille de la population
p <- floor(N/n) # Le pas de sondage
init <- sample(1:p, 1) # Unité statistique initiale
systematique <- MetMtidy[seq(from = init, to = N, by = p),]
```

Voici la distribution de _M&M's_ par couleur.

```{r}
kable(freq(systematique$Couleur,
     total = TRUE,
     valid = FALSE))
```

```{r}
ggplot(systematique, aes(x = Couleur, fill = Couleur))+
  geom_bar(aes(y = (..count..)/sum(..count..)))+
  scale_fill_manual(guide=FALSE,
                    values = c("Bleu"="blue", 
                               "Brun"="brown",
                               "Jaune"="yellow",
                               "Orange"="orange",
                               "Rouge"="red",
                               "Vert"="green"))+
  labs(y = "Pourcentage")
```

Voici la distribution du nombre de _M&M's_ par paquet.

```{r}
kable(freq(systematique$Nom,
           total = TRUE,
           valid = FALSE))
```

```{r}
ggplot(systematique, aes(x = Nom))+
  geom_bar()+
  labs(y = "Nombre de M&M's")
```

**TODO**

1. J'aimerais introduire les méthodes d'échantillonnage en utilisant les _M&M's_
1. Chaque étudiant reçoit une boîte
1. Les étudiants comptent le nombre de bonbons de chaque couleur
1. Je rentre l'information dans une tibble avec le nom de l'étudiant (ça permet de faire une grappe)
1. Les couleurs permettent de faire des strates

Comment construire facilement la tibble? Créer une fonction du genre

```
m-m(nom, qté rouge, qté bleu, ...)
```

```{r}
library(tidyverse)
library(questionr)

set.seed(12345)

n <- 24 #On rentre 24 données par personnes
prenoms <- c("Marc-André", "Mélanie", "Anna", "Laurent")
couleurs <- c("Bleu", "Brun", "Orange", "Vert", "Jaune", "Rouge") #Les couleurs possibles

metm <- tibble(nom = character(), couleur = character())

for (i in prenoms){
  temp <- tibble(
                  nom = rep(i, n),
                  couleur = sample(couleurs, n, replace = TRUE)
                )
  metm <- rbind(metm, temp)
}

freq(metm$couleur, total = TRUE, valid = FALSE)
```

